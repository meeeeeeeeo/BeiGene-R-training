<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>tidyr</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="config/style.css" type="text/css" />
<link rel="stylesheet" href="config/click-zoom.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="RStudioIDE.html">RStudio IDE</a>
</li>
<li>
  <a href="base_R.html">Base R</a>
</li>
<li>
  <a href="tidyverse-base.html">tidyverse base</a>
</li>
<li>
  <a href="stringr_hs.html">stringr</a>
</li>
<li>
  <a href="datetime_qw.html">date and time</a>
</li>
<li>
  <a href="read-write.html">data import/export</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    ggplot2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplot2_basic.html">basic</a>
    </li>
    <li>
      <a href="ggplot2_layers.html">layers</a>
    </li>
    <li>
      <a href="arranging-plots.html">arranging plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pipe.html">Using pipe</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">focusing on package</li>
    <li>
      <a href="data-process-dplyr.html">data process - dplyr</a>
    </li>
    <li>
      <a href="data-process-tidyr.html">data process - tidyr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Use SQL in R</li>
    <li>
      <a href="sqldf.html">sqldf</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">tidyr</h1>

</div>


<pre class="r"><code>library(tidyverse)
packageVersion(&quot;tidyr&quot;)
#&gt; [1] &#39;1.1.3&#39;</code></pre>
<div id="separate-and-unite-character-vectors" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Separate and unite character vectors</h1>
<div id="extract-character-column-with-regex-groups-extract" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Extract character column with regex groups: <code>extract()</code></h2>
<p>Given a regular expression with capturing groups, <code>extract()</code> turns each group into a new column. If the groups don’t match, or the input is <code>NA</code>, the output will be <code>NA.</code></p>
<pre class="r"><code>df &lt;- tibble(folder = c(&#39;Screening&#39;, &#39;Cycle 1 Day 1&#39;, &#39;Cycle 2 Day 15&#39;))
df
#&gt; # A tibble: 3 x 1
#&gt;   folder        
#&gt;   &lt;chr&gt;         
#&gt; 1 Screening     
#&gt; 2 Cycle 1 Day 1 
#&gt; 3 Cycle 2 Day 15

df %&gt;% extract(
  col = folder,
  into = c(&#39;cycle&#39;, &#39;day&#39;),
  regex = &#39;Cycle (\\d+) Day (\\d+)&#39;
)
#&gt; # A tibble: 3 x 2
#&gt;   cycle day  
#&gt;   &lt;chr&gt; &lt;chr&gt;
#&gt; 1 &lt;NA&gt;  &lt;NA&gt; 
#&gt; 2 1     1    
#&gt; 3 2     15

df %&gt;% extract(
  col = folder,
  into = c(&#39;cycle&#39;, &#39;day&#39;),
  regex = &#39;Cycle (\\d+) Day (\\d+)&#39;,
  remove = F
)
#&gt; # A tibble: 3 x 2
#&gt;   cycle day  
#&gt;   &lt;chr&gt; &lt;chr&gt;
#&gt; 1 &lt;NA&gt;  &lt;NA&gt; 
#&gt; 2 1     1    
#&gt; 3 2     15</code></pre>
</div>
<div id="separate-character-column-with-separator-separate" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Separate character column with separator: <code>separate()</code></h2>
<p>Given either a regular expression or a vector of character positions, <code>separate()</code> turns a single character column into multiple columns.</p>
<ul>
<li><p>regex separator</p>
<pre class="r"><code>df &lt;- tibble(x = c(&#39;a,b:c&#39;, &#39;d_e_f&#39;))
df
#&gt; # A tibble: 2 x 1
#&gt;   x    
#&gt;   &lt;chr&gt;
#&gt; 1 a,b:c
#&gt; 2 d_e_f

df %&gt;% separate(
  col = x,
  into = c(&#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;),
  sep = &#39;[,:_]&#39;
)
#&gt; # A tibble: 2 x 3
#&gt;   x1    x2    x3   
#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1 a     b     c    
#&gt; 2 d     e     f

df %&gt;% separate(
  col = x,
  into = c(&#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;),
  sep = &#39;[,:_]&#39;,
  remove = F
)
#&gt; # A tibble: 2 x 3
#&gt;   x1    x2    x3   
#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1 a     b     c    
#&gt; 2 d     e     f</code></pre></li>
<li><p>numeric vector is interpreted as character positions to split at.</p>
<pre class="r"><code>df &lt;- tibble(fruit = c(&#39;apple&#39;, &#39;orange&#39;, &#39;pear&#39;, &#39;banana&#39;))
df
#&gt; # A tibble: 4 x 1
#&gt;   fruit 
#&gt;   &lt;chr&gt; 
#&gt; 1 apple 
#&gt; 2 orange
#&gt; 3 pear  
#&gt; 4 banana

df %&gt;% separate(
  col = fruit,
  into = c(&#39;var1&#39;, &#39;var2&#39;, &#39;var3&#39;),
  sep = c(2, 5)
)
#&gt; # A tibble: 4 x 3
#&gt;   var1  var2  var3 
#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1 ap    ple   &quot;&quot;   
#&gt; 2 or    ang   &quot;e&quot;  
#&gt; 3 pe    ar    &quot;&quot;   
#&gt; 4 ba    nan   &quot;a&quot;

df %&gt;% separate(
  col = fruit,
  into = c(&#39;var1&#39;, &#39;var2&#39;),
  sep = -2
)
#&gt; # A tibble: 4 x 2
#&gt;   var1  var2 
#&gt;   &lt;chr&gt; &lt;chr&gt;
#&gt; 1 app   le   
#&gt; 2 oran  ge   
#&gt; 3 pe    ar   
#&gt; 4 bana  na</code></pre></li>
</ul>
<p>You can use <code>extra</code> and <code>fill</code> when there are too many pieces (or not enough pieces):</p>
<p><code>extra</code>: If <code>sep</code> is a character vector, this controls what happens when there are too many pieces. There are three valid options:</p>
<ul>
<li><p>“warn” (the default): emit a warning and drop extra values.</p></li>
<li><p>“drop”: drop any extra values without a warning.</p></li>
<li><p>“merge”: only splits at most <code>length(into)</code> times</p>
<pre class="r"><code>df &lt;- tibble(fruits = c(&#39;apples, oranges, pears, bananas&#39;, &#39;pineapples, mangos, guavas&#39;))
df
#&gt; # A tibble: 2 x 1
#&gt;   fruits                         
#&gt;   &lt;chr&gt;                          
#&gt; 1 apples, oranges, pears, bananas
#&gt; 2 pineapples, mangos, guavas

df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;),
  sep = &#39;, &#39;
)
#&gt; Warning: Expected 2 pieces. Additional pieces discarded in 2 rows [1, 2].
#&gt; # A tibble: 2 x 2
#&gt;   fruit1     fruit2 
#&gt;   &lt;chr&gt;      &lt;chr&gt;  
#&gt; 1 apples     oranges
#&gt; 2 pineapples mangos

df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;),
  sep = &#39;, &#39;,
  extra = &#39;drop&#39;
)
#&gt; # A tibble: 2 x 2
#&gt;   fruit1     fruit2 
#&gt;   &lt;chr&gt;      &lt;chr&gt;  
#&gt; 1 apples     oranges
#&gt; 2 pineapples mangos

df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;),
  sep = &#39;, &#39;,
  extra = &#39;merge&#39;
)
#&gt; # A tibble: 2 x 2
#&gt;   fruit1     fruit2                 
#&gt;   &lt;chr&gt;      &lt;chr&gt;                  
#&gt; 1 apples     oranges, pears, bananas
#&gt; 2 pineapples mangos, guavas</code></pre></li>
</ul>
<p><code>fill</code>: If <code>sep</code> is a character vector, this controls what happens when there are not enough pieces. There are three valid options:</p>
<ul>
<li><p>“warn” (the default): emit a warning and fill from the right</p></li>
<li><p>“right”: fill with missing values on the right</p></li>
<li><p>“left”: fill with missing values on the left</p>
<pre class="r"><code>df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;, &#39;fruit3&#39;, &#39;fruit4&#39;, &#39;fruit5&#39;),
  sep = &#39;, &#39;
)
#&gt; Warning: Expected 5 pieces. Missing pieces filled with `NA` in 2 rows [1, 2].
#&gt; # A tibble: 2 x 5
#&gt;   fruit1     fruit2  fruit3 fruit4  fruit5
#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; 
#&gt; 1 apples     oranges pears  bananas &lt;NA&gt;  
#&gt; 2 pineapples mangos  guavas &lt;NA&gt;    &lt;NA&gt;

df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;, &#39;fruit3&#39;, &#39;fruit4&#39;, &#39;fruit5&#39;),
  sep = &#39;, &#39;,
  fill = &#39;right&#39;
)
#&gt; # A tibble: 2 x 5
#&gt;   fruit1     fruit2  fruit3 fruit4  fruit5
#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; 
#&gt; 1 apples     oranges pears  bananas &lt;NA&gt;  
#&gt; 2 pineapples mangos  guavas &lt;NA&gt;    &lt;NA&gt;

df %&gt;% separate(
  col = fruits,
  into = c(&#39;fruit1&#39;, &#39;fruit2&#39;, &#39;fruit3&#39;, &#39;fruit4&#39;, &#39;fruit5&#39;),
  sep = &#39;, &#39;,
  fill = &#39;left&#39;
)
#&gt; # A tibble: 2 x 5
#&gt;   fruit1 fruit2 fruit3     fruit4 fruit5 
#&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  
#&gt; 1 &lt;NA&gt;   apples oranges    pears  bananas
#&gt; 2 &lt;NA&gt;   &lt;NA&gt;   pineapples mangos guavas</code></pre></li>
</ul>
</div>
<div id="separate-character-column-into-multiple-rows-separate_rows" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Separate character column into multiple rows: <code>separate_rows()</code></h2>
<pre class="r"><code>df &lt;- tibble(
  id = 1:2,
  fruits = c(
    &quot;apples and oranges and pears and bananas&quot;,
    &quot;pineapples and mangos and guavas&quot;
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;      id fruits                                  
#&gt;   &lt;int&gt; &lt;chr&gt;                                   
#&gt; 1     1 apples and oranges and pears and bananas
#&gt; 2     2 pineapples and mangos and guavas

df %&gt;% separate_rows(fruits, sep = &#39; and &#39;)
#&gt; # A tibble: 7 x 2
#&gt;      id fruits    
#&gt;   &lt;int&gt; &lt;chr&gt;     
#&gt; 1     1 apples    
#&gt; 2     1 oranges   
#&gt; 3     1 pears     
#&gt; 4     1 bananas   
#&gt; 5     2 pineapples
#&gt; 6     2 mangos    
#&gt; 7     2 guavas</code></pre>
</div>
<div id="unite-multiple-columns-into-one-unite" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> Unite multiple columns into one: <code>unite()</code></h2>
<pre class="r"><code>df &lt;- tibble(x = c(&#39;a&#39;, &#39;b&#39;), y = c(&#39;c&#39;, &#39;d&#39;), z = c(&#39;e&#39;, &#39;f&#39;))
df
#&gt; # A tibble: 2 x 3
#&gt;   x     y     z    
#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1 a     c     e    
#&gt; 2 b     d     f

df %&gt;% unite(xy, c(x, y), sep = &#39;_&#39;)
#&gt; # A tibble: 2 x 2
#&gt;   xy    z    
#&gt;   &lt;chr&gt; &lt;chr&gt;
#&gt; 1 a_c   e    
#&gt; 2 b_d   f

df %&gt;% unite(xyz, x:z, sep = &#39;.&#39;)
#&gt; # A tibble: 2 x 1
#&gt;   xyz  
#&gt;   &lt;chr&gt;
#&gt; 1 a.c.e
#&gt; 2 b.d.f

df %&gt;% unite(xyz, x:z, sep = &#39;.&#39;, remove = F)
#&gt; # A tibble: 2 x 1
#&gt;   xyz  
#&gt;   &lt;chr&gt;
#&gt; 1 a.c.e
#&gt; 2 b.d.f</code></pre>
<p>You can use <code>na.rm</code> to remove missing values:</p>
<pre class="r"><code>df &lt;- tibble(x = c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;), y = c(&#39;d&#39;, &#39;e&#39;, NA))
df
#&gt; # A tibble: 3 x 2
#&gt;   x     y    
#&gt;   &lt;chr&gt; &lt;chr&gt;
#&gt; 1 a     d    
#&gt; 2 b     e    
#&gt; 3 c     &lt;NA&gt;

df %&gt;% unite(xy, c(x, y), sep = &#39;_&#39;)
#&gt; # A tibble: 3 x 1
#&gt;   xy   
#&gt;   &lt;chr&gt;
#&gt; 1 a_d  
#&gt; 2 b_e  
#&gt; 3 c_NA

df %&gt;% unite(xy, c(x, y), sep = &#39;_&#39;, na.rm = T)
#&gt; # A tibble: 3 x 1
#&gt;   xy   
#&gt;   &lt;chr&gt;
#&gt; 1 a_d  
#&gt; 2 b_e  
#&gt; 3 c</code></pre>
</div>
</div>
<div id="handle-missing-values" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Handle missing values</h1>
<div id="drop-rows-containing-missing-values-drop_na" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Drop rows containing missing values: <code>drop_na()</code></h2>
<pre class="r"><code>df &lt;- tibble(x = c(1, 2, NA), y = c(&quot;a&quot;, NA, &quot;b&quot;))
df
#&gt; # A tibble: 3 x 2
#&gt;       x y    
#&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1     1 a    
#&gt; 2     2 &lt;NA&gt; 
#&gt; 3    NA b

df %&gt;% drop_na()
#&gt; # A tibble: 1 x 2
#&gt;       x y    
#&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1     1 a

df %&gt;% drop_na(x)
#&gt; # A tibble: 2 x 2
#&gt;       x y    
#&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1     1 a    
#&gt; 2     2 &lt;NA&gt;</code></pre>
</div>
<div id="replace-nas-with-specified-values-replace_na" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Replace NAs with specified values: <code>replace_na()</code></h2>
<ul>
<li><p>Replace NAs for vector</p>
<pre class="r"><code>x &lt;- c(&#39;a&#39;, &#39;b&#39;, NA)
replace_na(x, &#39;missing&#39;)
#&gt; [1] &quot;a&quot;       &quot;b&quot;       &quot;missing&quot;</code></pre></li>
<li><p>Replace NAs for dataframe</p>
<pre class="r"><code>df &lt;- tibble(x = c(1, 2, NA), y = c(&quot;a&quot;, NA, &quot;b&quot;))
df
#&gt; # A tibble: 3 x 2
#&gt;       x y    
#&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1     1 a    
#&gt; 2     2 &lt;NA&gt; 
#&gt; 3    NA b

df %&gt;% replace_na(list(x = 0, y = &quot;unknown&quot;))
#&gt; # A tibble: 3 x 2
#&gt;       x y      
#&gt;   &lt;dbl&gt; &lt;chr&gt;  
#&gt; 1     1 a      
#&gt; 2     2 unknown
#&gt; 3     0 b</code></pre></li>
</ul>
</div>
<div id="fill-in-missing-values-with-previous-or-next-value-fill" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Fill in missing values with previous or next value: <code>fill()</code></h2>
<p>You can fill missing values in selected columns using the next or previous entry. The direction can be chose as “down” (the default), “up”, “downup” (i.e. first down and then up) or “updown” (first up and then down).</p>
<pre class="r"><code>df &lt;- tribble(
  ~quarter, ~year, ~sales,
  &quot;Q1&quot;,      NA,    66013,
  &quot;Q2&quot;,      NA,    69182,
  &quot;Q3&quot;,    2000,    53175,
  &quot;Q4&quot;,      NA,    21001,
  &quot;Q1&quot;,    2001,    46036,
  &quot;Q2&quot;,      NA,    58842,
  &quot;Q3&quot;,      NA,    44568,
  &quot;Q4&quot;,      NA,    50197,
)

df %&gt;% fill(year)
#&gt; # A tibble: 8 x 3
#&gt;   quarter  year sales
#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Q1         NA 66013
#&gt; 2 Q2         NA 69182
#&gt; 3 Q3       2000 53175
#&gt; 4 Q4       2000 21001
#&gt; 5 Q1       2001 46036
#&gt; 6 Q2       2001 58842
#&gt; 7 Q3       2001 44568
#&gt; 8 Q4       2001 50197

df %&gt;% fill(year, .direction = &#39;up&#39;)
#&gt; # A tibble: 8 x 3
#&gt;   quarter  year sales
#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Q1       2000 66013
#&gt; 2 Q2       2000 69182
#&gt; 3 Q3       2000 53175
#&gt; 4 Q4       2001 21001
#&gt; 5 Q1       2001 46036
#&gt; 6 Q2         NA 58842
#&gt; 7 Q3         NA 44568
#&gt; 8 Q4         NA 50197

df %&gt;% fill(year, .direction = &#39;downup&#39;)
#&gt; # A tibble: 8 x 3
#&gt;   quarter  year sales
#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Q1       2000 66013
#&gt; 2 Q2       2000 69182
#&gt; 3 Q3       2000 53175
#&gt; 4 Q4       2000 21001
#&gt; 5 Q1       2001 46036
#&gt; 6 Q2       2001 58842
#&gt; 7 Q3       2001 44568
#&gt; 8 Q4       2001 50197</code></pre>
<p>You can use <code>fill()</code> to “retain” value from previous observations. For example, you can get the dosage from latest cycle (dosage who is not <code>0</code> or <code>NA</code>):</p>
<pre class="r"><code>df &lt;- tibble(cycle = 1:7, dose = c(1, 0, NA, 2, 3, NA, 4))
df
#&gt; # A tibble: 7 x 2
#&gt;   cycle  dose
#&gt;   &lt;int&gt; &lt;dbl&gt;
#&gt; 1     1     1
#&gt; 2     2     0
#&gt; 3     3    NA
#&gt; 4     4     2
#&gt; 5     5     3
#&gt; 6     6    NA
#&gt; 7     7     4

df %&gt;% 
  mutate(
    last_dose = if_else(dose %in% c(0, NA), NA_real_, dose),
    last_dose = lag(last_dose)
  ) %&gt;% 
  fill(last_dose)
#&gt; # A tibble: 7 x 3
#&gt;   cycle  dose last_dose
#&gt;   &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;
#&gt; 1     1     1        NA
#&gt; 2     2     0         1
#&gt; 3     3    NA         1
#&gt; 4     4     2         1
#&gt; 5     5     3         2
#&gt; 6     6    NA         3
#&gt; 7     7     4         3</code></pre>
</div>
</div>
<div id="reshape-data" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Reshape data</h1>
<div id="pivot-data-from-wide-to-long-pivot_longer" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Pivot data from wide to long: <code>pivot_longer()</code></h2>
<p><code>pivot_longer()</code> “Lengthen” data by collapsing several columns into two. You can select columns by <code>cols</code> with <code>&lt;tidy-select&gt;</code>, column names move to a new <code>names_to</code> column and values to a new <code>values_to</code> column.</p>
<pre class="r"><code>pivot_longer(
  data,
  cols,
  names_to = &quot;name&quot;,
  names_prefix = NULL,
  names_sep = NULL,
  names_pattern = NULL,
  values_to = &quot;value&quot;,
  values_drop_na = FALSE
)</code></pre>
<div id="simplest-case" class="section level3 unnumbered">
<h3 class="unnumbered">Simplest case</h3>
<pre class="r"><code>table4a
#&gt; # A tibble: 3 x 3
#&gt;   country     `1999` `2000`
#&gt; * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258 213766

table4a %&gt;% pivot_longer(c(`1999`, `2000`), names_to = &#39;year&#39;, values_to = &#39;cases&#39;)
#&gt; # A tibble: 6 x 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258
#&gt; 6 China       2000  213766</code></pre>
<p><img src="figures/tidyr/pivot_longer.png" /></p>
</div>
<div id="drop-rows-that-correspond-to-missing-values" class="section level3 unnumbered">
<h3 class="unnumbered">Drop rows that correspond to missing values</h3>
<p>You can drop rows that contain only <code>NA</code> in the <code>values_to</code> column:</p>
<pre class="r"><code>df &lt;- tribble(
  ~id, ~choice1, ~choice2, ~choice3,
  1, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;,
  2, &quot;C&quot;, &quot;B&quot;,  NA,
  3, &quot;D&quot;,  NA,  NA,
  4, &quot;B&quot;, &quot;D&quot;,  NA
)

df %&gt;% pivot_longer(!id)
#&gt; # A tibble: 12 x 3
#&gt;       id name    value
#&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;
#&gt;  1     1 choice1 A    
#&gt;  2     1 choice2 B    
#&gt;  3     1 choice3 C    
#&gt;  4     2 choice1 C    
#&gt;  5     2 choice2 B    
#&gt;  6     2 choice3 &lt;NA&gt; 
#&gt;  7     3 choice1 D    
#&gt;  8     3 choice2 &lt;NA&gt; 
#&gt;  9     3 choice3 &lt;NA&gt; 
#&gt; 10     4 choice1 B    
#&gt; # … with 2 more rows

df %&gt;% pivot_longer(!id, values_drop_na = T)
#&gt; # A tibble: 8 x 3
#&gt;      id name    value
#&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;
#&gt; 1     1 choice1 A    
#&gt; 2     1 choice2 B    
#&gt; 3     1 choice3 C    
#&gt; 4     2 choice1 C    
#&gt; 5     2 choice2 B    
#&gt; 6     3 choice1 D    
#&gt; 7     4 choice1 B    
#&gt; 8     4 choice2 D</code></pre>
</div>
<div id="strip-common-prefix" class="section level3 unnumbered">
<h3 class="unnumbered">strip common prefix</h3>
<p>You can use <code>names_prefix</code> to strip common prefix:</p>
<pre class="r"><code>billboard
#&gt; # A tibble: 317 x 79
#&gt;    artist   track   date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
#&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 2 Pac    Baby D… 2000-02-26      87    82    72    77    87    94    99    NA
#&gt;  2 2Ge+her  The Ha… 2000-09-02      91    87    92    NA    NA    NA    NA    NA
#&gt;  3 3 Doors… Krypto… 2000-04-08      81    70    68    67    66    57    54    53
#&gt;  4 3 Doors… Loser   2000-10-21      76    76    72    69    67    65    55    59
#&gt;  5 504 Boyz Wobble… 2000-04-15      57    34    25    17    17    31    36    49
#&gt;  6 98^0     Give M… 2000-08-19      51    39    34    26    26    19     2     2
#&gt;  7 A*Teens  Dancin… 2000-07-08      97    97    96    95   100    NA    NA    NA
#&gt;  8 Aaliyah  I Don&#39;… 2000-01-29      84    62    51    41    38    35    35    38
#&gt;  9 Aaliyah  Try Ag… 2000-03-18      59    53    38    28    21    18    16    14
#&gt; 10 Adams, … Open M… 2000-08-26      76    76    74    69    68    67    61    58
#&gt; # … with 307 more rows, and 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,
#&gt; #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,
#&gt; #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;,
#&gt; #   wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,
#&gt; #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
#&gt; #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,
#&gt; #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;,
#&gt; #   wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;,
#&gt; #   wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;, wk55 &lt;dbl&gt;, wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;,
#&gt; #   wk59 &lt;dbl&gt;, wk60 &lt;dbl&gt;, wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;,
#&gt; #   wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;, wk67 &lt;lgl&gt;, wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;, wk70 &lt;lgl&gt;,
#&gt; #   wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;, wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;, wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;

billboard %&gt;% 
  pivot_longer(
    cols = starts_with(&quot;wk&quot;), 
    names_to = &quot;week&quot;,
    names_prefix = &#39;wk&#39;, 
    values_to = &quot;rank&quot;,
    values_drop_na = T
  )
#&gt; # A tibble: 5,307 x 5
#&gt;    artist  track                   date.entered week   rank
#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
#&gt;  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   1        87
#&gt;  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   2        82
#&gt;  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   3        72
#&gt;  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   4        77
#&gt;  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   5        87
#&gt;  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   6        94
#&gt;  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   7        99
#&gt;  8 2Ge+her The Hardest Part Of ... 2000-09-02   1        91
#&gt;  9 2Ge+her The Hardest Part Of ... 2000-09-02   2        87
#&gt; 10 2Ge+her The Hardest Part Of ... 2000-09-02   3        92
#&gt; # … with 5,297 more rows</code></pre>
</div>
<div id="multiple-variables-stored-in-column-names" class="section level3 unnumbered">
<h3 class="unnumbered">Multiple variables stored in column names</h3>
<p>You can extract multiple <code>names_to</code> columns via <code>names_sep</code> or <code>names_pattern</code>, for example, “sex” and “level” stored as column names and separated by <code>_</code>:</p>
<pre class="r"><code>df &lt;- tribble(
  ~subject,  ~f_1,  ~f_2, ~m_1, ~m_2,
         1,    11,    21,   31,   41,
         2,    12,    22,   32,   42,
         3,    13,    23,   33,   43,
)

df %&gt;% 
  pivot_longer(
    cols = !subject,
    names_to = c(&#39;sex&#39;, &#39;level&#39;),
    names_sep = &#39;_&#39;
  )
#&gt; # A tibble: 12 x 4
#&gt;    subject sex   level value
#&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt;  1       1 f     1        11
#&gt;  2       1 f     2        21
#&gt;  3       1 m     1        31
#&gt;  4       1 m     2        41
#&gt;  5       2 f     1        12
#&gt;  6       2 f     2        22
#&gt;  7       2 m     1        32
#&gt;  8       2 m     2        42
#&gt;  9       3 f     1        13
#&gt; 10       3 f     2        23
#&gt; # … with 2 more rows

df %&gt;% 
  pivot_longer(
    cols = !subject,
    names_to = c(&#39;sex&#39;, &#39;level&#39;),
    names_pattern = &#39;(.)_(.)&#39;
  )
#&gt; # A tibble: 12 x 4
#&gt;    subject sex   level value
#&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt;  1       1 f     1        11
#&gt;  2       1 f     2        21
#&gt;  3       1 m     1        31
#&gt;  4       1 m     2        41
#&gt;  5       2 f     1        12
#&gt;  6       2 f     2        22
#&gt;  7       2 m     1        32
#&gt;  8       2 m     2        42
#&gt;  9       3 f     1        13
#&gt; 10       3 f     2        23
#&gt; # … with 2 more rows</code></pre>
<p><code>names_sep</code> and <code>names_pattern</code> work same as <code>separate()</code> and <code>extract()</code>, you can also use <code>separate()</code> or <code>extract()</code> after <code>pivot_longer()</code>:</p>
<pre class="r"><code>df %&gt;% 
  pivot_longer(cols = !subject) %&gt;% 
  separate(col = &#39;name&#39;, into = c(&#39;sex&#39;, &#39;level&#39;), sep = &#39;_&#39;)
#&gt; # A tibble: 12 x 4
#&gt;    subject sex   level value
#&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt;  1       1 f     1        11
#&gt;  2       1 f     2        21
#&gt;  3       1 m     1        31
#&gt;  4       1 m     2        41
#&gt;  5       2 f     1        12
#&gt;  6       2 f     2        22
#&gt;  7       2 m     1        32
#&gt;  8       2 m     2        42
#&gt;  9       3 f     1        13
#&gt; 10       3 f     2        23
#&gt; # … with 2 more rows

df %&gt;% 
  pivot_longer(cols = !subject) %&gt;% 
  extract(col = &#39;name&#39;, into = c(&#39;sex&#39;, &#39;level&#39;), regex = &#39;(.)_(.)&#39;)
#&gt; # A tibble: 12 x 4
#&gt;    subject sex   level value
#&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt;  1       1 f     1        11
#&gt;  2       1 f     2        21
#&gt;  3       1 m     1        31
#&gt;  4       1 m     2        41
#&gt;  5       2 f     1        12
#&gt;  6       2 f     2        22
#&gt;  7       2 m     1        32
#&gt;  8       2 m     2        42
#&gt;  9       3 f     1        13
#&gt; 10       3 f     2        23
#&gt; # … with 2 more rows</code></pre>
</div>
<div id="multiple-group-of-columns-to-pivot" class="section level3 unnumbered">
<h3 class="unnumbered">Multiple group of columns to pivot</h3>
<pre class="r"><code>family &lt;- tribble(
  ~family,  ~dob_child1,  ~dob_child2, ~gender_child1, ~gender_child2,
       1L, &quot;1998-11-26&quot;, &quot;2000-01-29&quot;,             1L,             2L,
       2L, &quot;1996-06-22&quot;,           NA,             2L,             NA,
       3L, &quot;2002-07-11&quot;, &quot;2004-04-05&quot;,             2L,             2L,
       4L, &quot;2004-10-10&quot;, &quot;2009-08-27&quot;,             1L,             1L,
       5L, &quot;2000-12-05&quot;, &quot;2005-02-28&quot;,             2L,             1L,
)</code></pre>
<p>We have two pieces of information (or values) for each child: their <code>gender</code> and their <code>dob</code>, these need to go into separate columns in the result. Here we use <code>names_sep</code> to split up each variable name, use a special name <code>.value</code> in <code>names_to</code> to extract the name of the “value” columns, and ignore the argument <code>values_to</code>.</p>
<pre class="r"><code>family %&gt;% 
  pivot_longer(
    !family, 
    names_to = c(&quot;.value&quot;, &quot;child&quot;), 
    names_sep = &quot;_&quot;, 
    values_drop_na = TRUE
  )
#&gt; # A tibble: 9 x 4
#&gt;   family child  dob        gender
#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;
#&gt; 1      1 child1 1998-11-26      1
#&gt; 2      1 child2 2000-01-29      2
#&gt; 3      2 child1 1996-06-22      2
#&gt; 4      3 child1 2002-07-11      2
#&gt; 5      3 child2 2004-04-05      2
#&gt; 6      4 child1 2004-10-10      1
#&gt; 7      4 child2 2009-08-27      1
#&gt; 8      5 child1 2000-12-05      2
#&gt; 9      5 child2 2005-02-28      1</code></pre>
<div class="click-zoom-1-5">
<p><label> <input type="checkbox"> <img src="figures/tidyr/pivot_longer-multi.png"> </label></p>
</div>
</div>
</div>
<div id="pivot-data-from-long-to-wide-pivot_wider" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Pivot data from long to wide: <code>pivot_wider()</code></h2>
<p><code>pivot_wider()</code> “Widen” data by expanding two columns into several. <code>names_from</code> provides the new column names and <code>values_from</code> provides the values.</p>
<pre class="r"><code>pivot_wider(
  data,
  id_cols = NULL,
  names_from = name,
  names_prefix = &quot;&quot;,
  names_sep = &quot;_&quot;,
  names_glue = NULL,
  values_from = value,
  values_fill = NULL
)</code></pre>
<div id="simplest-case-1" class="section level3" number="3.2.1">
<h3 number="3.2.1"><span class="header-section-number">3.2.1</span> Simplest case</h3>
<pre class="r"><code>table2
#&gt; # A tibble: 12 x 4
#&gt;    country      year type            count
#&gt;    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
#&gt;  1 Afghanistan  1999 cases             745
#&gt;  2 Afghanistan  1999 population   19987071
#&gt;  3 Afghanistan  2000 cases            2666
#&gt;  4 Afghanistan  2000 population   20595360
#&gt;  5 Brazil       1999 cases           37737
#&gt;  6 Brazil       1999 population  172006362
#&gt;  7 Brazil       2000 cases           80488
#&gt;  8 Brazil       2000 population  174504898
#&gt;  9 China        1999 cases          212258
#&gt; 10 China        1999 population 1272915272
#&gt; # … with 2 more rows

table2 %&gt;% pivot_wider(names_from = type, values_from = count)
#&gt; # A tibble: 6 x 4
#&gt;   country      year  cases population
#&gt;   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan  1999    745   19987071
#&gt; 2 Afghanistan  2000   2666   20595360
#&gt; 3 Brazil       1999  37737  172006362
#&gt; 4 Brazil       2000  80488  174504898
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
<p><img src="figures/tidyr/pivot_wider.png" /></p>
</div>
<div id="fill-in-missing-values" class="section level3" number="3.2.2">
<h3 number="3.2.2"><span class="header-section-number">3.2.2</span> Fill in missing values</h3>
<p>You can fill in missing values with <code>values_fill</code>:</p>
<pre class="r"><code>fish_encounters
#&gt; # A tibble: 114 x 3
#&gt;    fish  station  seen
#&gt;    &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
#&gt;  1 4842  Release     1
#&gt;  2 4842  I80_1       1
#&gt;  3 4842  Lisbon      1
#&gt;  4 4842  Rstr        1
#&gt;  5 4842  Base_TD     1
#&gt;  6 4842  BCE         1
#&gt;  7 4842  BCW         1
#&gt;  8 4842  BCE2        1
#&gt;  9 4842  BCW2        1
#&gt; 10 4842  MAE         1
#&gt; # … with 104 more rows

fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen)
#&gt; # A tibble: 19 x 12
#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE   MAW
#&gt;    &lt;fct&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1 4842        1     1      1     1       1     1     1     1     1     1     1
#&gt;  2 4843        1     1      1     1       1     1     1     1     1     1     1
#&gt;  3 4844        1     1      1     1       1     1     1     1     1     1     1
#&gt;  4 4845        1     1      1     1       1    NA    NA    NA    NA    NA    NA
#&gt;  5 4847        1     1      1    NA      NA    NA    NA    NA    NA    NA    NA
#&gt;  6 4848        1     1      1     1      NA    NA    NA    NA    NA    NA    NA
#&gt;  7 4849        1     1     NA    NA      NA    NA    NA    NA    NA    NA    NA
#&gt;  8 4850        1     1     NA     1       1     1     1    NA    NA    NA    NA
#&gt;  9 4851        1     1     NA    NA      NA    NA    NA    NA    NA    NA    NA
#&gt; 10 4854        1     1     NA    NA      NA    NA    NA    NA    NA    NA    NA
#&gt; # … with 9 more rows

fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen, values_fill = 0)
#&gt; # A tibble: 19 x 12
#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE   MAW
#&gt;    &lt;fct&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt;  1 4842        1     1      1     1       1     1     1     1     1     1     1
#&gt;  2 4843        1     1      1     1       1     1     1     1     1     1     1
#&gt;  3 4844        1     1      1     1       1     1     1     1     1     1     1
#&gt;  4 4845        1     1      1     1       1     0     0     0     0     0     0
#&gt;  5 4847        1     1      1     0       0     0     0     0     0     0     0
#&gt;  6 4848        1     1      1     1       0     0     0     0     0     0     0
#&gt;  7 4849        1     1      0     0       0     0     0     0     0     0     0
#&gt;  8 4850        1     1      0     1       1     1     1     0     0     0     0
#&gt;  9 4851        1     1      0     0       0     0     0     0     0     0     0
#&gt; 10 4854        1     1      0     0       0     0     0     0     0     0     0
#&gt; # … with 9 more rows</code></pre>
</div>
<div id="generate-column-name-from-multiple-variables" class="section level3" number="3.2.3">
<h3 number="3.2.3"><span class="header-section-number">3.2.3</span> Generate column name from multiple variables</h3>
<p>When <code>names_from</code> or <code>values_from</code> contains multiple variables, <code>names_sep</code> or <code>names_glue</code> can be used to generate the new column names.</p>
<ul>
<li><p>use <code>names_sep</code> or <code>names_glue</code> to combine multiple <code>names_from</code>:</p>
<pre class="r"><code>production &lt;- expand_grid(
    product = c(&quot;A&quot;, &quot;B&quot;), 
    country = c(&quot;AI&quot;, &quot;EI&quot;), 
    year = 2000:2014
  ) %&gt;%
  filter((product == &quot;A&quot; &amp; country == &quot;AI&quot;) | product == &quot;B&quot;) %&gt;% 
  mutate(production = rnorm(n()))

production
#&gt; # A tibble: 45 x 4
#&gt;    product country  year production
#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
#&gt;  1 A       AI       2000      0.896
#&gt;  2 A       AI       2001      0.732
#&gt;  3 A       AI       2002     -0.308
#&gt;  4 A       AI       2003     -0.951
#&gt;  5 A       AI       2004     -0.356
#&gt;  6 A       AI       2005      1.32 
#&gt;  7 A       AI       2006     -0.125
#&gt;  8 A       AI       2007      0.515
#&gt;  9 A       AI       2008      0.667
#&gt; 10 A       AI       2009     -0.464
#&gt; # … with 35 more rows

production %&gt;% pivot_wider(
  names_from = c(product, country), 
  values_from = production,
  names_sep = &quot;.&quot;
)
#&gt; # A tibble: 15 x 4
#&gt;     year   A.AI      B.AI    B.EI
#&gt;    &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1  2000  0.896 -0.0120   -0.366 
#&gt;  2  2001  0.732 -0.993    -0.639 
#&gt;  3  2002 -0.308 -0.306     0.952 
#&gt;  4  2003 -0.951  0.159    -0.484 
#&gt;  5  2004 -0.356 -0.000914 -0.680 
#&gt;  6  2005  1.32  -0.672     0.200 
#&gt;  7  2006 -0.125  2.65     -0.0429
#&gt;  8  2007  0.515  2.00      0.509 
#&gt;  9  2008  0.667  1.41     -1.16  
#&gt; 10  2009 -0.464  0.604     0.846 
#&gt; # … with 5 more rows

production %&gt;% pivot_wider(
  names_from = c(product, country), 
  values_from = production,
  names_glue = &quot;{country}_{product}&quot;
)
#&gt; # A tibble: 15 x 4
#&gt;     year   AI_A      AI_B    EI_B
#&gt;    &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
#&gt;  1  2000  0.896 -0.0120   -0.366 
#&gt;  2  2001  0.732 -0.993    -0.639 
#&gt;  3  2002 -0.308 -0.306     0.952 
#&gt;  4  2003 -0.951  0.159    -0.484 
#&gt;  5  2004 -0.356 -0.000914 -0.680 
#&gt;  6  2005  1.32  -0.672     0.200 
#&gt;  7  2006 -0.125  2.65     -0.0429
#&gt;  8  2007  0.515  2.00      0.509 
#&gt;  9  2008  0.667  1.41     -1.16  
#&gt; 10  2009 -0.464  0.604     0.846 
#&gt; # … with 5 more rows</code></pre></li>
<li><p>use multiple <code>values_from</code> to pivot groups of columns:</p>
<pre class="r"><code>us_rent_income
#&gt; # A tibble: 104 x 5
#&gt;    GEOID NAME       variable estimate   moe
#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 01    Alabama    income      24476   136
#&gt;  2 01    Alabama    rent          747     3
#&gt;  3 02    Alaska     income      32940   508
#&gt;  4 02    Alaska     rent         1200    13
#&gt;  5 04    Arizona    income      27517   148
#&gt;  6 04    Arizona    rent          972     4
#&gt;  7 05    Arkansas   income      23789   165
#&gt;  8 05    Arkansas   rent          709     5
#&gt;  9 06    California income      29454   109
#&gt; 10 06    California rent         1358     3
#&gt; # … with 94 more rows

us_rent_income %&gt;%
  pivot_wider(
    names_from = variable,
    names_glue = &quot;{variable}_{.value}&quot;,
    values_from = c(estimate, moe)
  )
#&gt; # A tibble: 52 x 6
#&gt;    GEOID NAME                 income_estimate rent_estimate income_moe rent_moe
#&gt;    &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 01    Alabama                        24476           747        136        3
#&gt;  2 02    Alaska                         32940          1200        508       13
#&gt;  3 04    Arizona                        27517           972        148        4
#&gt;  4 05    Arkansas                       23789           709        165        5
#&gt;  5 06    California                     29454          1358        109        3
#&gt;  6 08    Colorado                       32401          1125        109        5
#&gt;  7 09    Connecticut                    35326          1123        195        5
#&gt;  8 10    Delaware                       31560          1076        247       10
#&gt;  9 11    District of Columbia           43198          1424        681       17
#&gt; 10 12    Florida                        25952          1077         70        3
#&gt; # … with 42 more rows</code></pre></li>
</ul>
<div class="click-zoom-1-5">
<p><label> <input type="checkbox"> <img src="figures/tidyr/pivot_wider-multi.png"> </label></p>
</div>
</div>
</div>
<div id="longer-then-wider" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> longer then wider</h2>
<p>You can combine <code>pivot_longer()</code> and <code>pivot_wider()</code> for more complex problems:</p>
<pre class="r"><code>df &lt;- tribble(
  ~ group, ~ level1, ~ level2,
      &#39;a&#39;,        3,        4,
      &#39;b&#39;,       50,      100,
      &#39;c&#39;,      200,     1000,
)

df %&gt;% pivot_longer(starts_with(&#39;level&#39;), names_to = &#39;level&#39;, values_to = &#39;value&#39;)
#&gt; # A tibble: 6 x 3
#&gt;   group level  value
#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 a     level1     3
#&gt; 2 a     level2     4
#&gt; 3 b     level1    50
#&gt; 4 b     level2   100
#&gt; 5 c     level1   200
#&gt; 6 c     level2  1000

df %&gt;% 
  pivot_longer(starts_with(&#39;level&#39;), names_to = &#39;level&#39;, values_to = &#39;value&#39;) %&gt;% 
  pivot_wider(names_from = &#39;group&#39;, values_from = &#39;value&#39;)
#&gt; # A tibble: 2 x 4
#&gt;   level      a     b     c
#&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 level1     3    50   200
#&gt; 2 level2     4   100  1000</code></pre>
</div>
<div id="using-pivotting-specification" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Using pivotting specification</h2>
<p>To gain more control over pivotting, you can create a “spec” data frame that describes exactly how data stored in the column names becomes variables (and vice versa).</p>
<p>You can refer to <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/pivot.html#manual-specs" target="_blank">Pivoting | Manual specs</a></p>
</div>
</div>
<div id="generate-complete-data" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Generate “complete” data</h1>
<div id="create-tibble-from-all-combinations-of-inputs-expand_grid" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Create tibble from all combinations of inputs: <code>expand_grid()</code></h2>
<pre class="r"><code>expand_grid(x = 1:2, y = c(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;))
#&gt; # A tibble: 6 x 2
#&gt;       x y    
#&gt;   &lt;int&gt; &lt;chr&gt;
#&gt; 1     1 a    
#&gt; 2     1 b    
#&gt; 3     1 c    
#&gt; 4     2 a    
#&gt; 5     2 b    
#&gt; 6     2 c

expand_grid(var1 = c(1, 2, 1), var2 = c(&#39;a&#39;, &#39;b&#39;))
#&gt; # A tibble: 6 x 2
#&gt;    var1 var2 
#&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1     1 a    
#&gt; 2     1 b    
#&gt; 3     2 a    
#&gt; 4     2 b    
#&gt; 5     1 a    
#&gt; 6     1 b</code></pre>
</div>
<div id="expand-data-frame-to-include-all-possible-combinations-of-values-expand" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> Expand data frame to include all possible combinations of values: <code>expand()</code></h2>
<p><code>expand()</code> generates all combination of variables found in a dataset, and drop other columns:</p>
<pre class="r"><code>fruits &lt;- tibble(
  type   = c(&quot;apple&quot;, &quot;orange&quot;, &quot;apple&quot;, &quot;orange&quot;, &quot;orange&quot;, &quot;orange&quot;),
  year   = c(2010, 2010, 2012, 2010, 2010, 2012),
  size  =  c(&quot;XS&quot;, &quot;S&quot;,  &quot;M&quot;, &quot;S&quot;, &quot;S&quot;, &quot;M&quot;)
)

fruits %&gt;% expand(type, year)
#&gt; # A tibble: 4 x 2
#&gt;   type    year
#&gt;   &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 apple   2010
#&gt; 2 apple   2012
#&gt; 3 orange  2010
#&gt; 4 orange  2012

fruits %&gt;% expand(type, year, size)
#&gt; # A tibble: 12 x 3
#&gt;    type    year size 
#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
#&gt;  1 apple   2010 M    
#&gt;  2 apple   2010 S    
#&gt;  3 apple   2010 XS   
#&gt;  4 apple   2012 M    
#&gt;  5 apple   2012 S    
#&gt;  6 apple   2012 XS   
#&gt;  7 orange  2010 M    
#&gt;  8 orange  2010 S    
#&gt;  9 orange  2010 XS   
#&gt; 10 orange  2012 M    
#&gt; # … with 2 more rows</code></pre>
<p>It’s same as using <code>expand_grid()</code> and <code>unique()</code> out of the dataset:</p>
<pre class="r"><code>expand_grid(type = unique(fruits$type), year = unique(fruits$year))
#&gt; # A tibble: 4 x 2
#&gt;   type    year
#&gt;   &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 apple   2010
#&gt; 2 apple   2012
#&gt; 3 orange  2010
#&gt; 4 orange  2012

expand_grid(type = unique(fruits$type), year = unique(fruits$year), size = unique(fruits$size))
#&gt; # A tibble: 12 x 3
#&gt;    type    year size 
#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
#&gt;  1 apple   2010 XS   
#&gt;  2 apple   2010 S    
#&gt;  3 apple   2010 M    
#&gt;  4 apple   2012 XS   
#&gt;  5 apple   2012 S    
#&gt;  6 apple   2012 M    
#&gt;  7 orange  2010 XS   
#&gt;  8 orange  2010 S    
#&gt;  9 orange  2010 M    
#&gt; 10 orange  2012 XS   
#&gt; # … with 2 more rows</code></pre>
<p>You can use <code>nesting()</code> in <code>expand()</code> if you only want to choose combinations that already appear in the data:</p>
<pre class="r"><code>fruits %&gt;% expand(nesting(type, size))
#&gt; # A tibble: 4 x 2
#&gt;   type   size 
#&gt;   &lt;chr&gt;  &lt;chr&gt;
#&gt; 1 apple  M    
#&gt; 2 apple  XS   
#&gt; 3 orange M    
#&gt; 4 orange S

fruits %&gt;% expand(nesting(type, size), year)
#&gt; # A tibble: 8 x 3
#&gt;   type   size   year
#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
#&gt; 1 apple  M      2010
#&gt; 2 apple  M      2012
#&gt; 3 apple  XS     2010
#&gt; 4 apple  XS     2012
#&gt; 5 orange M      2010
#&gt; 6 orange M      2012
#&gt; 7 orange S      2010
#&gt; 8 orange S      2012</code></pre>
</div>
<div id="complete-data-frame-with-missing-combinations-of-data-complete" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Complete data frame with missing combinations of data: <code>complete()</code></h2>
<p>In contrast to <code>expand()</code>, <code>complete()</code> keep other columns and leave them <code>NA</code> if combinations don’t appear in the dataset:</p>
<pre class="r"><code>df &lt;- tibble(
  group = c(1:2, 1),
  item_name = c(&quot;a&quot;, &quot;b&quot;, &quot;b&quot;),
  value1 = 1:3,
  value2 = 4:6
)
df
#&gt; # A tibble: 3 x 4
#&gt;   group item_name value1 value2
#&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;
#&gt; 1     1 a              1      4
#&gt; 2     2 b              2      5
#&gt; 3     1 b              3      6

df %&gt;% expand(group, item_name)
#&gt; # A tibble: 4 x 2
#&gt;   group item_name
#&gt;   &lt;dbl&gt; &lt;chr&gt;    
#&gt; 1     1 a        
#&gt; 2     1 b        
#&gt; 3     2 a        
#&gt; 4     2 b

df %&gt;% complete(group, item_name)
#&gt; # A tibble: 4 x 4
#&gt;   group item_name value1 value2
#&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;
#&gt; 1     1 a              1      4
#&gt; 2     1 b              3      6
#&gt; 3     2 a             NA     NA
#&gt; 4     2 b              2      5</code></pre>
<p>You can also choose to fill in missing values:</p>
<pre class="r"><code>df %&gt;% complete(group, item_name, fill = list(value1 = 0))
#&gt; # A tibble: 4 x 4
#&gt;   group item_name value1 value2
#&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;int&gt;
#&gt; 1     1 a              1      4
#&gt; 2     1 b              3      6
#&gt; 3     2 a              0     NA
#&gt; 4     2 b              2      5</code></pre>
</div>
<div id="duplicate-rows-according-to-counts-uncount" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> Duplicate rows according to counts: <code>uncount()</code></h2>
<p><code>uncount()</code> duplicating rows according to a weighting variable (or constants, expressions)</p>
<pre class="r"><code>df &lt;- tibble(x = c(&quot;a&quot;, &quot;b&quot;), n = c(1, 2))
df
#&gt; # A tibble: 2 x 2
#&gt;   x         n
#&gt;   &lt;chr&gt; &lt;dbl&gt;
#&gt; 1 a         1
#&gt; 2 b         2

uncount(df, n)
#&gt; # A tibble: 3 x 1
#&gt;   x    
#&gt;   &lt;chr&gt;
#&gt; 1 a    
#&gt; 2 b    
#&gt; 3 b

uncount(df, n, .remove = F)
#&gt; # A tibble: 3 x 1
#&gt;   x    
#&gt;   &lt;chr&gt;
#&gt; 1 a    
#&gt; 2 b    
#&gt; 3 b

uncount(df, 3)
#&gt; # A tibble: 6 x 2
#&gt;   x         n
#&gt;   &lt;chr&gt; &lt;dbl&gt;
#&gt; 1 a         1
#&gt; 2 a         1
#&gt; 3 a         1
#&gt; 4 b         2
#&gt; 5 b         2
#&gt; 6 b         2

uncount(df, n + 1)
#&gt; # A tibble: 5 x 2
#&gt;   x         n
#&gt;   &lt;chr&gt; &lt;dbl&gt;
#&gt; 1 a         1
#&gt; 2 a         1
#&gt; 3 b         2
#&gt; 4 b         2
#&gt; 5 b         2</code></pre>
</div>
<div id="create-the-full-sequence-of-values-in-a-vector-full_seq" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> Create the full sequence of values in a vector: <code>full_seq()</code></h2>
<pre class="r"><code>year &lt;- c(2020, 2015, 2018, 2021)

full_seq(year, 1)
#&gt; [1] 2015 2016 2017 2018 2019 2020 2021</code></pre>
</div>
</div>
<div id="work-with-nested-data" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Work with nested data</h1>
<div id="create-nested-data" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Create nested data</h2>
<div id="nest" class="section level3" number="5.1.1">
<h3 number="5.1.1"><span class="header-section-number">5.1.1</span> <code>nest()</code></h3>
<p><code>nest()</code> create list-column of tibbles:</p>
<pre class="r"><code>df &lt;- tribble(
  ~g, ~x, ~y,
   1,  1,  2,
   2,  4,  6,
   2,  5,  7,
   3, 10,  NA
)
df %&gt;% nest(data = c(x, y))
#&gt; # A tibble: 3 x 2
#&gt;       g data                
#&gt;   &lt;dbl&gt; &lt;list&gt;              
#&gt; 1     1 &lt;tibble[,2] [1 × 2]&gt;
#&gt; 2     2 &lt;tibble[,2] [2 × 2]&gt;
#&gt; 3     3 &lt;tibble[,2] [1 × 2]&gt;

iris %&gt;% nest(width = contains(&quot;Width&quot;), length = contains(&quot;Length&quot;))
#&gt; # A tibble: 3 x 3
#&gt;   Species    width                 length               
#&gt;   &lt;fct&gt;      &lt;list&gt;                &lt;list&gt;               
#&gt; 1 setosa     &lt;tibble[,2] [50 × 2]&gt; &lt;tibble[,2] [50 × 2]&gt;
#&gt; 2 versicolor &lt;tibble[,2] [50 × 2]&gt; &lt;tibble[,2] [50 × 2]&gt;
#&gt; 3 virginica  &lt;tibble[,2] [50 × 2]&gt; &lt;tibble[,2] [50 × 2]&gt;</code></pre>
<p>Nesting a grouped data frame nests all variables apart from the group vars:</p>
<pre class="r"><code>df %&gt;% group_by(g) %&gt;% nest()
#&gt; # A tibble: 3 x 2
#&gt; # Groups:   g [3]
#&gt;       g data                
#&gt;   &lt;dbl&gt; &lt;list&gt;              
#&gt; 1     1 &lt;tibble[,2] [1 × 2]&gt;
#&gt; 2     2 &lt;tibble[,2] [2 × 2]&gt;
#&gt; 3     3 &lt;tibble[,2] [1 × 2]&gt;</code></pre>
</div>
<div id="create-tibble-with-list-columns" class="section level3" number="5.1.2">
<h3 number="5.1.2"><span class="header-section-number">5.1.2</span> Create tibble with list-columns</h3>
<p>You can create simple nested data by hand:</p>
<pre class="r"><code>df &lt;- tibble(
  g = c(1, 2, 3),
  data = list(
    tibble(x = 1, y = 2),
    tibble(x = 4:5, y = 6:7),
    tibble(x = 10)
  )
)
df
#&gt; # A tibble: 3 x 2
#&gt;       g data                
#&gt;   &lt;dbl&gt; &lt;list&gt;              
#&gt; 1     1 &lt;tibble[,2] [1 × 2]&gt;
#&gt; 2     2 &lt;tibble[,2] [2 × 2]&gt;
#&gt; 3     3 &lt;tibble[,1] [1 × 1]&gt;

df &lt;- tibble(
  g = c(1, 2, 3),
  data = list(1, 4:5, 10)
)
df
#&gt; # A tibble: 3 x 2
#&gt;       g data     
#&gt;   &lt;dbl&gt; &lt;list&gt;   
#&gt; 1     1 &lt;dbl [1]&gt;
#&gt; 2     2 &lt;int [2]&gt;
#&gt; 3     3 &lt;dbl [1]&gt;</code></pre>
</div>
<div id="from-other-functions" class="section level3" number="5.1.3">
<h3 number="5.1.3"><span class="header-section-number">5.1.3</span> From other functions</h3>
<p><code>mutate()</code>, <code>transmute()</code>, and <code>summarise()</code> will output list-columns if they return a list.</p>
<pre class="r"><code>nest_mtcars &lt;- mtcars %&gt;% 
  group_by(cyl) %&gt;% 
  summarise(q = list(quantile(mpg)))
nest_mtcars
#&gt; # A tibble: 3 x 2
#&gt;     cyl q        
#&gt;   &lt;dbl&gt; &lt;list&gt;   
#&gt; 1     4 &lt;dbl [5]&gt;
#&gt; 2     6 &lt;dbl [5]&gt;
#&gt; 3     8 &lt;dbl [5]&gt;

nest_mtcars$q
#&gt; [[1]]
#&gt;   0%  25%  50%  75% 100% 
#&gt; 21.4 22.8 26.0 30.4 33.9 
#&gt; 
#&gt; [[2]]
#&gt;    0%   25%   50%   75%  100% 
#&gt; 17.80 18.65 19.70 21.00 21.40 
#&gt; 
#&gt; [[3]]
#&gt;    0%   25%   50%   75%  100% 
#&gt; 10.40 14.40 15.20 16.25 19.20

df &lt;- tibble(
  id = 1:2,
  fruits = c(
    &quot;apples and oranges and pears and bananas&quot;,
    &quot;pineapples and mangos and guavas&quot;
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;      id fruits                                  
#&gt;   &lt;int&gt; &lt;chr&gt;                                   
#&gt; 1     1 apples and oranges and pears and bananas
#&gt; 2     2 pineapples and mangos and guavas

nest_df &lt;- df %&gt;% mutate(fruit = str_split(fruits, &#39; and &#39;))
nest_df
#&gt; # A tibble: 2 x 3
#&gt;      id fruits                                   fruit    
#&gt;   &lt;int&gt; &lt;chr&gt;                                    &lt;list&gt;   
#&gt; 1     1 apples and oranges and pears and bananas &lt;chr [4]&gt;
#&gt; 2     2 pineapples and mangos and guavas         &lt;chr [3]&gt;

nest_df$fruit
#&gt; [[1]]
#&gt; [1] &quot;apples&quot;  &quot;oranges&quot; &quot;pears&quot;   &quot;bananas&quot;
#&gt; 
#&gt; [[2]]
#&gt; [1] &quot;pineapples&quot; &quot;mangos&quot;     &quot;guavas&quot;</code></pre>
</div>
</div>
<div id="reshape-nested-data" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Reshape nested data</h2>
<p><code>unnest()</code>, <code>unnest_longer()</code>, <code>unnest_wider()</code>, and <code>hoist()</code> can flatten list-column in nested data, <code>unnest()</code> is commonly used to unnest list-column of data frames, <code>unnest_longer()</code> <code>unnest_wider()</code> is commonly used to unnest list-column of vector (or deep nested list), <code>hoist()</code> selectively pull list components out into their own top-level columns.</p>
<div id="unnest" class="section level3" number="5.2.1">
<h3 number="5.2.1"><span class="header-section-number">5.2.1</span> <code>unnest()</code></h3>
<p><code>unnest(data, cols, ..., keep_empty = FALSE)</code> flatten nested columns back to regular columns. By default, rows who contain a size-0 element (like <code>NULL</code> or an empty data frame) will be dropped from the output, you can <code>keep_empty = TRUE</code> to replace size-0 elements with a single row of missing values.</p>
<pre class="r"><code>df &lt;- tibble(
  x = 1:3,
  y = list(
    NULL,
    tibble(a = 1, b = 2),
    tibble(a = 1:3, b = 3:1)
  )
)

df %&gt;% unnest(y)
#&gt; # A tibble: 4 x 3
#&gt;       x     a     b
#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     2     1     2
#&gt; 2     3     1     3
#&gt; 3     3     2     2
#&gt; 4     3     3     1

df %&gt;% unnest(y, keep_empty = TRUE)
#&gt; # A tibble: 5 x 3
#&gt;       x     a     b
#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     1    NA    NA
#&gt; 2     2     1     2
#&gt; 3     3     1     3
#&gt; 4     3     2     2
#&gt; 5     3     3     1</code></pre>
</div>
<div id="unnest_longer" class="section level3" number="5.2.2">
<h3 number="5.2.2"><span class="header-section-number">5.2.2</span> <code>unnest_longer()</code></h3>
<p><code>unnest_longer(data, col, values_to = NULL, indices_to = NULL)</code> turn each element of a list-column into a row.</p>
<pre class="r"><code>starwars %&gt;% select(name, films)
#&gt; # A tibble: 87 x 2
#&gt;    name               films    
#&gt;    &lt;chr&gt;              &lt;list&gt;   
#&gt;  1 Luke Skywalker     &lt;chr [5]&gt;
#&gt;  2 C-3PO              &lt;chr [6]&gt;
#&gt;  3 R2-D2              &lt;chr [7]&gt;
#&gt;  4 Darth Vader        &lt;chr [4]&gt;
#&gt;  5 Leia Organa        &lt;chr [5]&gt;
#&gt;  6 Owen Lars          &lt;chr [3]&gt;
#&gt;  7 Beru Whitesun lars &lt;chr [3]&gt;
#&gt;  8 R5-D4              &lt;chr [1]&gt;
#&gt;  9 Biggs Darklighter  &lt;chr [1]&gt;
#&gt; 10 Obi-Wan Kenobi     &lt;chr [6]&gt;
#&gt; # … with 77 more rows

starwars %&gt;% 
  select(name, films) %&gt;% 
  unnest_longer(films)
#&gt; # A tibble: 173 x 2
#&gt;    name           films                  
#&gt;    &lt;chr&gt;          &lt;chr&gt;                  
#&gt;  1 Luke Skywalker The Empire Strikes Back
#&gt;  2 Luke Skywalker Revenge of the Sith    
#&gt;  3 Luke Skywalker Return of the Jedi     
#&gt;  4 Luke Skywalker A New Hope             
#&gt;  5 Luke Skywalker The Force Awakens      
#&gt;  6 C-3PO          The Empire Strikes Back
#&gt;  7 C-3PO          Attack of the Clones   
#&gt;  8 C-3PO          The Phantom Menace     
#&gt;  9 C-3PO          Revenge of the Sith    
#&gt; 10 C-3PO          Return of the Jedi     
#&gt; # … with 163 more rows</code></pre>
<p>A new column will be generated if the list-column contains the inner names, <code>values_to</code> and <code>indices_to</code> can give the column name of the values and inner names.</p>
<pre class="r"><code>df &lt;- tibble(
  name = c(&#39;001&#39;, &#39;002&#39;),
  demographic = list(
    list(sex = &#39;male&#39;, age = &#39;22&#39;),
    list(sex = &#39;famale&#39;, age = &#39;21&#39;)
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;   name  demographic     
#&gt;   &lt;chr&gt; &lt;list&gt;          
#&gt; 1 001   &lt;named list [2]&gt;
#&gt; 2 002   &lt;named list [2]&gt;

df %&gt;% unnest_longer(demographic)
#&gt; # A tibble: 4 x 3
#&gt;   name  demographic demographic_id
#&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;         
#&gt; 1 001   male        sex           
#&gt; 2 001   22          age           
#&gt; 3 002   famale      sex           
#&gt; 4 002   21          age

df %&gt;% unnest_longer(demographic, values_to = &#39;value&#39;, indices_to = &#39;field&#39;)
#&gt; # A tibble: 4 x 3
#&gt;   name  value  field
#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
#&gt; 1 001   male   sex  
#&gt; 2 001   22     age  
#&gt; 3 002   famale sex  
#&gt; 4 002   21     age</code></pre>
</div>
<div id="unnest_wider" class="section level3" number="5.2.3">
<h3 number="5.2.3"><span class="header-section-number">5.2.3</span> <code>unnest_wider()</code></h3>
<p><code>unnest_wider(data, col)</code> turn each element of a list-column into a regular column.</p>
<pre class="r"><code>df &lt;- tibble(
  name = c(&#39;001&#39;, &#39;002&#39;),
  demographic = list(
    list(sex = &#39;male&#39;, age = &#39;22&#39;),
    list(sex = &#39;famale&#39;, age = &#39;21&#39;)
  )
)

df %&gt;% unnest_wider(demographic)
#&gt; # A tibble: 2 x 3
#&gt;   name  sex    age  
#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
#&gt; 1 001   male   22   
#&gt; 2 002   famale 21</code></pre>
<p>You can use <code>names_sep</code> as a separator to paste the inner and outer names together:</p>
<pre class="r"><code>df %&gt;% unnest_wider(demographic, names_sep = &#39;_&#39;)
#&gt; # A tibble: 2 x 3
#&gt;   name  demographic_sex demographic_age
#&gt;   &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;          
#&gt; 1 001   male            22             
#&gt; 2 002   famale          21</code></pre>
</div>
<div id="hoist" class="section level3" number="5.2.4">
<h3 number="5.2.4"><span class="header-section-number">5.2.4</span> <code>hoist()</code></h3>
<p><code>hoist(.data, .col, ..., .remove = TRUE)</code> Selectively pull list components out into their own top-level columns. <code>.remove = TRUE</code> will remove extracted components from <code>.col</code>, this ensures that each value lives only in one place.</p>
<pre class="r"><code>df &lt;- tibble(
  character = c(&quot;Toothless&quot;, &quot;Dory&quot;),
  metadata = list(
    list(
      species = &quot;dragon&quot;,
      color = &quot;black&quot;,
      films = c(
        &quot;How to Train Your Dragon&quot;,
        &quot;How to Train Your Dragon 2&quot;,
        &quot;How to Train Your Dragon: The Hidden World&quot;
       )
    ),
    list(
      species = &quot;blue tang&quot;,
      color = &quot;blue&quot;,
      films = c(&quot;Finding Nemo&quot;, &quot;Finding Dory&quot;)
    )
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;   character metadata        
#&gt;   &lt;chr&gt;     &lt;list&gt;          
#&gt; 1 Toothless &lt;named list [3]&gt;
#&gt; 2 Dory      &lt;named list [3]&gt;

df %&gt;% hoist(metadata,
  &quot;species&quot;,
  first_film = list(&quot;films&quot;, 1L),
  third_film = list(&quot;films&quot;, 3L)
)
#&gt; # A tibble: 2 x 5
#&gt;   character species   first_film        third_film                  metadata    
#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;             &lt;chr&gt;                       &lt;list&gt;      
#&gt; 1 Toothless dragon    How to Train You… How to Train Your Dragon: … &lt;named list…
#&gt; 2 Dory      blue tang Finding Nemo      &lt;NA&gt;                        &lt;named list…</code></pre>
</div>
</div>
<div id="transform-nested-data" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Transform nested data</h2>
<div id="rowwise" class="section level3" number="5.3.1">
<h3 number="5.3.1"><span class="header-section-number">5.3.1</span> <code>rowwise()</code></h3>
<p>If you want to transform the list-column without flatten it, i.e. using functions who receive one element in list-column as input, you can use <code>rowwise()</code> then <code>mutate()</code> a new column.</p>
<p>Within the <code>rowwise_df</code>, elements of list-columns appear directly (accessed with <code>[[ ]]</code>), not as lists of length one.</p>
<pre class="r"><code>mtcars_nested &lt;- mtcars %&gt;% 
  group_by(cyl) %&gt;% 
  nest()
mtcars_nested
#&gt; # A tibble: 3 x 2
#&gt; # Groups:   cyl [3]
#&gt;     cyl data                   
#&gt;   &lt;dbl&gt; &lt;list&gt;                 
#&gt; 1     6 &lt;tibble[,10] [7 × 10]&gt; 
#&gt; 2     4 &lt;tibble[,10] [11 × 10]&gt;
#&gt; 3     8 &lt;tibble[,10] [14 × 10]&gt;

mtcars_nested %&gt;% 
  rowwise() %&gt;% 
  mutate(dim = list(dim(data)))
#&gt; # A tibble: 3 x 3
#&gt; # Rowwise:  cyl
#&gt;     cyl data                    dim      
#&gt;   &lt;dbl&gt; &lt;list&gt;                  &lt;list&gt;   
#&gt; 1     6 &lt;tibble[,10] [7 × 10]&gt;  &lt;int [2]&gt;
#&gt; 2     4 &lt;tibble[,10] [11 × 10]&gt; &lt;int [2]&gt;
#&gt; 3     8 &lt;tibble[,10] [14 × 10]&gt; &lt;int [2]&gt;

mtcars_nested %&gt;% 
  rowwise() %&gt;% 
  mutate(n = nrow(data))
#&gt; # A tibble: 3 x 3
#&gt; # Rowwise:  cyl
#&gt;     cyl data                        n
#&gt;   &lt;dbl&gt; &lt;list&gt;                  &lt;int&gt;
#&gt; 1     6 &lt;tibble[,10] [7 × 10]&gt;      7
#&gt; 2     4 &lt;tibble[,10] [11 × 10]&gt;    11
#&gt; 3     8 &lt;tibble[,10] [14 × 10]&gt;    14

mtcars_nested %&gt;% 
  rowwise() %&gt;% 
  mutate(model = list(lm(mpg ~ wt, data = data)))
#&gt; # A tibble: 3 x 3
#&gt; # Rowwise:  cyl
#&gt;     cyl data                    model 
#&gt;   &lt;dbl&gt; &lt;list&gt;                  &lt;list&gt;
#&gt; 1     6 &lt;tibble[,10] [7 × 10]&gt;  &lt;lm&gt;  
#&gt; 2     4 &lt;tibble[,10] [11 × 10]&gt; &lt;lm&gt;  
#&gt; 3     8 &lt;tibble[,10] [14 × 10]&gt; &lt;lm&gt;</code></pre>
<blockquote>
<p>Note that you should use <code>list()</code> to wrap the output if it’s not a <a href="https://r4ds.had.co.nz/vectors.html#vector-basics" target="_blank">atomic vectors</a>.</p>
</blockquote>
</div>
</div>
<div id="sample-usage" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> Sample usage</h2>
<div id="unnest-list-result-from-functions" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> Unnest list result from functions</h3>
<p>Sometimes you want to use function who return a list, and flatten the function’s result:</p>
<pre class="r"><code>df &lt;- tibble(
  id = 1:2,
  fruits = c(
    &quot;apples and oranges and pears and bananas&quot;,
    &quot;pineapples and mangos and guavas&quot;
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;      id fruits                                  
#&gt;   &lt;int&gt; &lt;chr&gt;                                   
#&gt; 1     1 apples and oranges and pears and bananas
#&gt; 2     2 pineapples and mangos and guavas

df %&gt;% 
  mutate(fruit = str_split(fruits, &#39; and &#39;)) %&gt;% 
  unnest_longer(fruit)
#&gt; # A tibble: 7 x 3
#&gt;      id fruits                                   fruit     
#&gt;   &lt;int&gt; &lt;chr&gt;                                    &lt;chr&gt;     
#&gt; 1     1 apples and oranges and pears and bananas apples    
#&gt; 2     1 apples and oranges and pears and bananas oranges   
#&gt; 3     1 apples and oranges and pears and bananas pears     
#&gt; 4     1 apples and oranges and pears and bananas bananas   
#&gt; 5     2 pineapples and mangos and guavas         pineapples
#&gt; 6     2 pineapples and mangos and guavas         mangos    
#&gt; 7     2 pineapples and mangos and guavas         guavas</code></pre>
<p>Here you can use <code>separate_rows()</code> directly, but this is a sample usage to tell you how to work with functions who return list.</p>
</div>
<div id="unnest-deeply-nested-data" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> Unnest deeply nested data</h3>
<p>Deeply nested list often sourced from the tree data structure (JSON or XML), you can collapse deeply nested lists into regular columns via <code>unnest_longer()</code> (into “observations”) and <code>unnest_wider()</code> (into “variables”).</p>
<pre class="r"><code>df &lt;- tibble(
  character = c(&quot;Toothless&quot;, &quot;Dory&quot;),
  metadata = list(
    list(
      species = &quot;dragon&quot;,
      color = &quot;black&quot;,
      films = c(
        &quot;How to Train Your Dragon&quot;,
        &quot;How to Train Your Dragon 2&quot;,
        &quot;How to Train Your Dragon: The Hidden World&quot;
       )
    ),
    list(
      species = &quot;blue tang&quot;,
      color = &quot;blue&quot;,
      films = c(&quot;Finding Nemo&quot;, &quot;Finding Dory&quot;)
    )
  )
)
df
#&gt; # A tibble: 2 x 2
#&gt;   character metadata        
#&gt;   &lt;chr&gt;     &lt;list&gt;          
#&gt; 1 Toothless &lt;named list [3]&gt;
#&gt; 2 Dory      &lt;named list [3]&gt;

df %&gt;% 
  unnest_wider(metadata)
#&gt; # A tibble: 2 x 4
#&gt;   character species   color films    
#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;list&gt;   
#&gt; 1 Toothless dragon    black &lt;chr [3]&gt;
#&gt; 2 Dory      blue tang blue  &lt;chr [2]&gt;

df %&gt;% 
  unnest_wider(metadata) %&gt;% 
  unnest_longer(films)
#&gt; # A tibble: 5 x 4
#&gt;   character species   color films                                     
#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;                                     
#&gt; 1 Toothless dragon    black How to Train Your Dragon                  
#&gt; 2 Toothless dragon    black How to Train Your Dragon 2                
#&gt; 3 Toothless dragon    black How to Train Your Dragon: The Hidden World
#&gt; 4 Dory      blue tang blue  Finding Nemo                              
#&gt; 5 Dory      blue tang blue  Finding Dory</code></pre>
</div>
<div id="read-multiple-pieces-of-data" class="section level3" number="5.4.3">
<h3 number="5.4.3"><span class="header-section-number">5.4.3</span> Read multiple pieces of data</h3>
<p>Suggest that we want to read the data: <a href="./data/iris_species.xlsx">iris_species.xlsx</a></p>
<p>The data is divided into three pieces and stored in three excel sheets: “setosa”, “versicolor”, and “virginica”. You can read them by using the list-column (without create three data frames to store the three pieces of data).</p>
<pre class="r"><code>library(readxl)

iris_data &lt;- tibble(species = excel_sheets(&#39;./data/iris_species.xlsx&#39;)) %&gt;% 
  rowwise() %&gt;% 
  mutate(data = list(read_excel(&#39;./data/iris_species.xlsx&#39;, sheet = species)))

iris_data
#&gt; # A tibble: 3 x 2
#&gt; # Rowwise: 
#&gt;   species    data                 
#&gt;   &lt;chr&gt;      &lt;list&gt;               
#&gt; 1 setosa     &lt;tibble[,4] [50 × 4]&gt;
#&gt; 2 versicolor &lt;tibble[,4] [50 × 4]&gt;
#&gt; 3 virginica  &lt;tibble[,4] [50 × 4]&gt;

iris_data %&gt;% unnest(data)
#&gt; # A tibble: 150 x 5
#&gt;    species Sepal.Length Sepal.Width Petal.Length Petal.Width
#&gt;    &lt;chr&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 setosa           5.1         3.5          1.4         0.2
#&gt;  2 setosa           4.9         3            1.4         0.2
#&gt;  3 setosa           4.7         3.2          1.3         0.2
#&gt;  4 setosa           4.6         3.1          1.5         0.2
#&gt;  5 setosa           5           3.6          1.4         0.2
#&gt;  6 setosa           5.4         3.9          1.7         0.4
#&gt;  7 setosa           4.6         3.4          1.4         0.3
#&gt;  8 setosa           5           3.4          1.5         0.2
#&gt;  9 setosa           4.4         2.9          1.4         0.2
#&gt; 10 setosa           4.9         3.1          1.5         0.1
#&gt; # … with 140 more rows</code></pre>
</div>
</div>
</div>
<div id="other-functions" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Other functions</h1>
<div id="chop-and-unchop-chop-unchop" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Chop and unchop: <code>chop()</code> <code>unchop()</code></h2>
<p>Chopping and unchopping preserve the width of a data frame, changing its length. <code>chop()</code> makes <code>data</code> shorter by converting rows within each group into list-columns. <code>unchop()</code> makes <code>data</code> longer by expanding list-columns so that each element of the list-column gets its own row in the output.</p>
<pre class="r"><code>df &lt;- tibble(x = c(1, 1, 1, 2, 2, 3), y = 1:6, z = 6:1)
df
#&gt; # A tibble: 6 x 3
#&gt;       x     y     z
#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     1     1     6
#&gt; 2     1     2     5
#&gt; 3     1     3     4
#&gt; 4     2     4     3
#&gt; 5     2     5     2
#&gt; 6     3     6     1

df1 &lt;- df %&gt;% chop(c(y, z))
df1
#&gt; # A tibble: 3 x 3
#&gt;       x           y           z
#&gt;   &lt;dbl&gt; &lt;list&lt;int&gt;&gt; &lt;list&lt;int&gt;&gt;
#&gt; 1     1         [3]         [3]
#&gt; 2     2         [2]         [2]
#&gt; 3     3         [1]         [1]

df1 %&gt;% unchop(c(y, z))
#&gt; # A tibble: 6 x 3
#&gt;       x     y     z
#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     1     1     6
#&gt; 2     1     2     5
#&gt; 3     1     3     4
#&gt; 4     2     4     3
#&gt; 5     2     5     2
#&gt; 6     3     6     1</code></pre>
</div>
<div id="pack-and-unpack-pack-unpack" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Pack and unpack: <code>pack()</code> <code>unpack()</code></h2>
<p>Packing and unpacking preserve the length of a data frame, changing its width. <code>pack()</code> makes <code>data</code> narrow by collapsing a set of columns into a single df-column. <code>unpack()</code> makes <code>data</code> wider by expanding df-columns back out into individual columns.</p>
<pre class="r"><code>df &lt;- tibble(x1 = 1:3, x2 = 4:6, x3 = 7:9, y = 1:3)
df
#&gt; # A tibble: 3 x 4
#&gt;      x1    x2    x3     y
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     1     4     7     1
#&gt; 2     2     5     8     2
#&gt; 3     3     6     9     3

df1 &lt;- df %&gt;% pack(x = starts_with(&quot;x&quot;))
df1
#&gt; # A tibble: 3 x 2
#&gt;       y  x$x1   $x2   $x3
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     1     1     4     7
#&gt; 2     2     2     5     8
#&gt; 3     3     3     6     9

dim(df1)
#&gt; [1] 3 2

str(df1)
#&gt; tibble[,2] [3 × 2] (S3: tbl_df/tbl/data.frame)
#&gt;  $ y: int [1:3] 1 2 3
#&gt;  $ x: tibble[,3] [3 × 3] (S3: tbl_df/tbl/data.frame)
#&gt;   ..$ x1: int [1:3] 1 2 3
#&gt;   ..$ x2: int [1:3] 4 5 6
#&gt;   ..$ x3: int [1:3] 7 8 9

df1 %&gt;% unpack(x)
#&gt; # A tibble: 3 x 4
#&gt;       y    x1    x2    x3
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     1     1     4     7
#&gt; 2     2     2     5     8
#&gt; 3     3     3     6     9</code></pre>
</div>
</div>
<div id="reference" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Reference</h1>
<p><a href="https://tidyr.tidyverse.org/index.html" target="_blank">Tidy Messy Data • tidyr</a></p>
<p><a href="https://github.com/rstudio/cheatsheets/blob/master/tidyr.pdf" target="_blank">cheatsheets - tidyr</a></p>
<p>tidyr vignettes:</p>
<p><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/pivot.html" target="_blank">Pivoting</a></p>
<p><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/nest.html" target="_blank">Nested data</a></p>
<p><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/rectangle.html" target="_blank">Rectangling</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
